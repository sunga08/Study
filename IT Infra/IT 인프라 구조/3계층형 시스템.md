## 1. 주요 개념 설명

### 1) 프로세스와 스레드

- OS상에서 실행돼서 독립성을 가지고 동작
- 커널에 의해 메모리상에 활동 공간을 확보하는 것이 필요
    - 프로세스 시작 의뢰가 있으면 커널이 프로세스를 작성하고 요청 분량만큼만 메모리 공간을 할당한다

**프로세스 vs. 스레드**
- 프로세스는 전용 메모리 공간을 이용해서 동작
- 스레드는 다른 스레드와 메모리 공간을 공유

### 2) OS 커널

- OS 처리는 원칙적으로 커널을 통해 이루어진다.

[커널의 역할]

1) 시스템 콜 인터페이스

- 프로세스/스레드에서 커널로 연결되는 인터페이스
- 애플리케이션이 OS를 통해 어떤 처리를 하고 싶으면 *시스템 콜* 이라는 명령을 이용해 커널에 명령을 내림

2) 프로세스 관리

- 언제, 어떤 프로세스가 어느 정도의 CPU 코어를 이용할 수 있는지, 처리 우선 순위를 어떻게 할 것인지 등을 관리

3) 메모리 관리

- 물리 메모리 공간의 최대치를 고려
- 프로세스가 이용하는 독립 메모리 공간을 확보하거나, 상호 간의 참조 영역을 지키기 위해 독립성 관리 등

4) 네트워크 스택

5) 파일 시스템 관리

- 파일 시스템용 인터페이스 제공
- 디렉토리 구조 제공, 액세스 관리, 고속화, 안정성 향상 등

6) 장치 드라이버

- 디스크, NIC 등의 물리 장치용 인터페이스 제공

## 2. 웹 데이터 흐름

클라이언트 PC - 웹 서버 - AP 서버 - DB 서버

### 1) 클라이언트 PC ~ 웹 서버

- PC에서 웹 브라우저 실행
    - 디스크에서 프로그램을 읽어서 프로세스를 시작, 메모리 공간 확보
    - 주소 창에 URL 입력 → **이름 해석**(DNS 서버에서 IP 주소 검색 결과 반환)
- 웹 서버에서 요청 접수
    - 웹 서버의 역할은 HTTP 요청에 대해 적절한 파일이나 콘텐츠를 반환하는 것
    - 웹 서버에는 HTTP를 처리할 수 있는 'httpd' 프로세스가 가동 중
- 웹 서버가 **정적 콘텐츠**인지, **동적 콘텐츠**인지 판단 → 필요한 경로로 데이터 액세스
    - 정적 콘텐츠
        - 실시간으로 변경할 필요가 없는 데이터
        - 데이터 갱신 빈도가 낮은 것은 **디스크에 저장**해서 요청이 있으면 저장해 둔 내용을 HTTP를 통해 사용자 웹 브라우저로 반환
    - 동적 콘텐츠
        - 높은 빈도로 변경되는 데이터 (ex. 은행 잔고 정보, 최신 날씨 데이터)
        - 갱신 빈도가 높기 때문에 서버 내부 디스크에 저장하면 병목 현상의 원인이 될 수 있음
        - 따라서 'AP 서버'가 HTML 파일을 동적으로 생성하며, 웹서버는 동적 콘텐츠에 대한 요청을 **AP 서버에게 던지고 결과를 기다린다.**

### 2) 웹 서버 ~ AP 서버

- AP서버에 웹 서버로부터 요청 도착
- 스레드가 요청을 받으면 자신이 계산할 수 있는지, DB 접속이 필요한지 판단
    - 단순 요청은 애플리케이션 상에서 계산하면 되기에 AP 서버의 담당 스레드가 계산 후 결과 반환
    - 그렇지 않으면 AP 서버의 스레드는 DB 서버에 질의하고, 그 결과를 HTML 등으로 정리해서 반환
- DB 접속이 필요하면 연결 풀에 액세스
- DB 서버에 요청 던짐

[DB 서버 이외의 옵션]

- 규모가 작고 갱신 빈도가 낮은 정보는 JVM 내부에 캐시로 저장해 두었다가 반환
- 규모가 큰 정적 데이터 전송 시에는 CDN이라 불리는 데이터 전송 전용 서버 이용

### 3) AP 서버 ~ DB 서버

- AP 서버로부터 요청 도착
- 프로세스가 요청을 접수하고 캐시가 존재하는지 확인
- 캐시에 없으면 디스크에 액세스
    - DB 서버는 데이터에 얼마나 효율적으로 액세스 하는가가 중요
        
        ⇒ 서버 메모리에 캐시가 있는지 먼저 확인, 없으면 디스크 액세스
        
    - 인메모리 DB에서는 디스크 자체를 사용하지 않고 모든 처리를 메모리 내에서 완료해 고속화 실현 가능
    - 실세로는 DB 서버 내부의 디스크를 직접 사용하는 경우는 드뭄 (이중화 관점에서 뒤떨어지기 때문에) → 별도 저장 장치 이용
- 디스크가 데이터 반환
- 데이터를 캐시 형태로 저장
- 결과를 AP 서버에 반환

[DB 서버의 예]

- 웹 계열: MySQL, PostgreSQL
- 기업용: Oracle, SQL Server

DB 서버에는 여러 개의 프로세스가 역할을 분담하는 경우가 있다.

- 서버 프로세스: 요청을 SQL로 받아서 해석하거나 데이터에 액세스
- LGWR, DBWR 프로세스: 메모리에 캐시로 존재하는 데이터와 디스크에 있는 데이터를 정기적으로 동기화

### 4) AP 서버 ~ 웹 서버

- DB 서버로부터 데이터 도착
- 스레드가 데이터를 가지고 계산 등을 한 후 파일 데이터 생성
- 결과를 웹 서버로 반환

### 5) 웹 서버 ~ 클라이언트 PC

- AP 서버로부터 데이터 도착
- 프로세스는 받은 데이터를 그대로 반환
- 결과가 웹 브라우저로 반환되고 화면에 표시됨

### 6) 웹 데이터의 흐름 정리

- 프로세스나 스레드가 요청을 받는다.
- 도착한 요청을 파악해서 필요에 따라 별도 서버로 요청을 보낸다.
- 도착한 요청에 대해 응답한다.

** 각 서버는 어느 정도 요청이 올지는 실제 요청이 오기 전까지는 알 수 없다.

⇒ IT 인프라에서 성능 이슈가 발생하는 이유 중 하나

## 3. 가상화

### 가상화

- 컴퓨터 시스템에서 물리 리소스(서버, 네트워크, 저장소 등)를 추상화하는 것
- 운영체제(OS)도 가상화 기술 중 하나
    - OS 등장 이전에는 하드웨어를 의식한 프로그래밍이 필요했음
    - OS 커널에 의해 하드웨어가 추상화되면서 하드웨어를 의식하지 않고 프로그래밍 가능
    - 가상 메모리를 사용해 프로세스 및 OS 커널의 메모리 공간을 분리

### 가상 머신

**호스트 OS형**

- 윈도우즈, 리눅스 등의 호스트 OS상에 가상화 소프트웨어를 설치해서 사용
- VMware Server, Microsoft Virtual Server 등

**하이퍼바이저형**

- 하드웨어상에서 직접 가상화 소프트웨어를 실행하고 그 위에 가상 머신을 동작시키는 기술
- 호스트 OS를 거치지 않으므로 호스트형보다 성능이 우수
- 서버 가상화의 대표 기술
- VMware vSphere, Hyper-V, Xen, KVM 등
- 가상화 구조 종류
    - 완전 가상화
        - 물리 머신상에서 동작하는 OS나 드라이버를 그대로 게스트로 이용할 수 있는 장점
        - 소프트웨어로 에뮬레이션하기 때문에 성능이 저하되는 문제
    - 준 가상화
        - 실제 하드웨어를 에뮬레이션하는 것이 아니라, 가상 환경용 가상 하드웨어를 소프트웨어적으로 에뮬레이션
        - 게스트 OS마다 준가상화 전용 드라이버나 준가상화용으로 최적화된 OS 커널을 이용했어야 했지만, 이후 프로세서 제조사가 가상 하드웨어 지원 기능을 개발해 현재는 완전 가상화가 자리 잡음
