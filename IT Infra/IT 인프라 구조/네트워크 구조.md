## 1. 계층 구조

### 계층 구조의 특징

- 데이터나 기능 호출 흐름에 따라 계층 간 역할이 나누어진다.
- 자신이 담당하는 일만 책임지며, 다른 계층들 사이에는 인터페이스만 정해두면 된다.
- 계층 간에 서로 영향을 주지 않고 독립적으로 동작이 가능하다.

### 계층 모델의 예

- OSI 7계층
- 서버 (애플리케이션 - JVM - OS)



## 2. 프로토콜

- 컴퓨터가 서로 소통하기 위해 정한 규약
- 계층구조에서 같은 계층 간의 약속



## 3. TCP/IP를 이용하고 있는 현재의 네트워크

### TCP/IP 계층 구조

- TCP와 IP 두 가지 프로토콜을 주축으로 한 프로토콜 집합
- TCP/IP 4계층 모델(링크 계층/IP계층/전송계층/어플리케이션 계층)
    - HTTP 통신 예
        - HTTP(어플리케이션 계층): httpd프로세스 사용, TCP에게 데이터 건넴
        - TCP(전송 계층): 애플리케이션이 의뢰한 데이터를 상대방에게 전달
        - IP(IP 계층): 데이터를 최종 위치까지 운반
        - 이더넷(링크 계층): 직접 연결돼 있는 주변 장비에 전송



## 4. 어플리케이션 계층의 프로토콜 HTTP

### HTTP의 처리 흐름

- 애플리케이션 계층 프로토콜은 자신이 통신하는 것이 아니라 통신 자체는 모두 OS, 즉 TCP/IP에 맡김
- 클라이언트와 웹 서버는 HTTP를 통해서 요청과 응답을 주고 받는다.
    - 데이터(HTTP 요청)를 소켓에 기록만 하고, 기록된 데이터는 TCP/IP를 통해 다른 한쪽의 소켓에 전달됨
    - 소켓 이하는 커널 공간에서 처리
        - TCP를 사용한다는 것과 IP 주소 및 포트 번호 정보를 시스템 콜 경유로 커널에 전달하면 접속 대상 서버와의 연결이 생성됨
        - 이 때 상대방 서버에서도 소켓이 만들어지며 상대 서버와의 사이에 가상 경로가 생성됨


## 5. 전송 계층 프로토콜 TCP

### TCP의 역할

- 애플리케이션이 보낸 데이터를 그 형태 그대로 상대방에게 확실히 전달하는 것
- 서버가 송수신할 때 애플리케이션에게 전달하는 역할을 할 뿐, 상대 서버까지 전송하는 부분은 하위 계층인 IP에게 위임
    - IP에는 데이터가 상대방에게 잘 전달됐는지 확인하는 기능이나 도착 순서를 확인하는 기능이 없음

<TCP의 중요 기능>

- 포트 번호를 이용해서 데이터 전송
- 연결 생성
- 데이터 보증과 재전송 제어
- 흐름 제어와 폭주 제어

### TCP 처리 흐름

- TCP는 데이터를 세그먼트 단위로 관리
    - 애플리케이션 데이터 + TCP 헤더 ⇒ TCP 세그먼트
    - MSS : TCP 세그먼트로 전송할 수 있는 최대 크기 데이터
    - MTU: 링크 계층에서 전송할 수 있는 최대 크기
    - MSS는 MTU에 의존적

- TCP 연결 생성
    - 통신 상대인 서버 측 OS에게 가상 경로를 열도록 의뢰
    - 서버 측에서는 리슨하고 있는 포트 번호로 통신 요구가 옴
    - 서버가 열어도 된다는 응답을 함
    - 통신용 가상 경로가 열림 (3-way handshaking)

### 데이터 보증과 재전송 제어

- 데이터 손실을 방지하는 구조
    - 확인 응답과 재전송에 의해 구현
    - 수신 측에 TCP 세그먼트가 도착하면 송신측에 ACK 반환
    - 송신측은 ACK를 보고 전송한 세그먼트가 무사히 도착했음을 안다
- 데이터 순서를 보증하는 구조
    - TCP 세그먼트에 시퀀스 번호를 붙여서 구현
        - 전체 데이터 중 몇 번째 바이트부터 시작하는 부분인지를 가리킴
- TCP 재전송 제어
    - 타임아웃 : 일정 시간 내에 ACK가 돌아오지 않으면 재전송
    - 특정 시퀀스의 세그먼트가 도착하지 않았을 경우 ACK에서 해당 시퀀스를 보내달라고 응답
        
        ⇒ 송신측에 3회 중복돼서 도착한 경우 그 번호에 해당하는 TCP 세그먼트가 도착하지 않았다고 간주하고 재전송
        

### 흐름 제어와 혼잡 제어

- 흐름 제어
    - 일정 세그먼트 개수 내에서는 ACK를 기다리지 않고 전송(=윈도우)
    - 슬라이딩 윈도우
- 혼잡 제어
    - 송신 측 윈도우 크기는 네트워크 혼잡 상태에 맞추어 변형
    - 슬로우 스타트
